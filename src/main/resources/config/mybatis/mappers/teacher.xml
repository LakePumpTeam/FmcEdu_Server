<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fmc.edu.teacher">
    <resultMap id="school" type="com.fmc.edu.model.school.School">
        <id property="id" column="scl_id"/>
        <result property="name" column="schoolName"/>
        <result property="provinceId" column="province_id"/>
        <result property="cityId" column="city_id"/>
        <result property="addressId" column="address_id"/>
    </resultMap>

    <resultMap id="teacher" type="com.fmc.edu.model.profile.TeacherProfile">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="phone" column="phone"/>
        <result property="appId" column="app_id"/>
        <result property="channelId" column="channel_id"/>
        <result property="creationDate" column="creation_date"/>
        <result property="lastLoginDate" column="last_login_date"/>
        <result property="lastUpdateDate" column="last_update_date"/>
        <result property="available" column="available"/>
        <result property="headTeacher" column="head_teacher"/>
        <result property="initialized" column="initialized"/>
        <result property="male" column="sex"/>
        <collection property="school" resultMap="school"/>
    </resultMap>

    <select id="queryTeacherById" parameterType="int" resultMap="teacher">
        select p.id, p.name, p.phone, p.app_id, p.channel_id, p.creation_date, p.last_login_date, p.last_update_date,
        p.available,
        t.head_teacher, t.initialized, t.sex,
        scl.id as scl_id, scl.name as schoolName, scl.province_id, scl.city_id, scl.address_id
        from profile p
        left join teacher t
        on p.id = t.profile_id
        left join school scl
        on scl.id = t.school_id
        where t.profile_id = #{id}
    </select>

    <select id="queryHeaderTeacherByParentId" parameterType="int" resultType="map">
        select pf.id as profileId,t_pf.id as teacherId, t_pf.name as teacherName, st.sex as sex, cls.grade as
        grade,cls.class as class from
        profile pf
        left join parent p
        on pf.id = p.profile_id
        left join parent_student_map psm
        on p.profile_id=psm.parent_id
        left join student st
        on st.id= psm.student_id
        left join class cls
        on cls.id = st.class_id
        left join teacher_class_map tcm
        on tcm.class_id=cls.id
        left join teacher t
        on t.profile_id = tcm.teacher_id
        left join profile t_pf
        on t_pf.id=t.profile_id
        where tcm.head_teacher=1 and pf.id = #{profileId};
    </select>

    <select id="queryClassByTeacherId" parameterType="int" resultType="map">
        SELECT cls.id as id, cls.school_id as schoolId,cls.grade as grade,cls.class as class,
         cls.available as available,cls.head_teacher_id as headTeacherId
        FROM teacher_class_map tcm
        LEFT JOIN class cls
        on tcm.class_id=cls.id
        where tcm.teacher_id=#{teacherId};
    </select>
</mapper>