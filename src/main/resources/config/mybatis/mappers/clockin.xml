<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fmc.edu.clockin">
    <select id="queryClockInRecords" parameterType="map" resultMap="rm.clockInRecord">
        SELECT `id`,
        `magnetic_card_id`,
        `type`,
        `attendance_flag`,
        `attendance_date`,
        `creation_date`,
        `clock_in_person_id`
        FROM clock_in_record
        WHERE <![CDATA[ attendance_date >= #{startDate}
                and attendance_date <= #{endDate}
                and type=#{type} and magnetic_card_id=#{magneticCardId}
                ]]>
        <if test="@Ognl@isNotEmpty(attendanceFlag)">
            and attendance_flag = #{attendanceFlag}
        </if>
    </select>

    <select id="queryMagneticByStudentId" parameterType="int" resultMap="rm.magneticCard">
       SELECT mc.`id`as id,
              mc.`card_no` as card_no,
              mc.`comments` as comments,
              mc.`last_update_date` as last_update_date,
              mc.`creation_date` as creation_date
        FROM `magnetic_card` mc
        INNER JOIN student_card_map scm
        ON mc.id = scm.magnetic_card_id
        WHERE scm.available=1 AND scm.approved=1 and scm.student_id=#{studentId};
    </select>

</mapper>